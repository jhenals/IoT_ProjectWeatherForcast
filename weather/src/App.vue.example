<template>
  <div id="app">
    <router-view v-if="isAuthenticated" />
    <div v-else>
      <p>Redirecting to login...</p>
    </div>
  </div>
</template>

<script>
import { initializeAuth, requireAuth, getUserSession } from '@/utils/auth-handler';
import { onMounted, ref } from 'vue';

export default {
  name: 'App',
  setup() {
    const isAuthenticated = ref(false);
    
    onMounted(() => {
      // Initialize auth on app load
      // This will:
      // 1. Check if token is in URL (redirected from login)
      // 2. Save token to localStorage if found  
      // 3. Check if already authenticated
      const authStatus = initializeAuth();
      
      if (!authStatus) {
        // Not authenticated - redirect to login
        requireAuth();
      } else {
        // Authenticated - show app
        isAuthenticated.value = true;
        
        const session = getUserSession();
        console.log('Welcome', session.email);
      }
    });
    
    return {
      isAuthenticated
    };
  }
};
</script>

<style>
/* Your styles */
</style>
